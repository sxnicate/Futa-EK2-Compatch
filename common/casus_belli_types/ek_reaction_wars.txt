### Imprison Dangerous Mage War
imprison_mage_war = {
	group = other
	
	allowed_for_character = {
		always = yes
	}

	allowed_against_character = {
		OR = {
			scope:attacker = {
				has_opinion_modifier = {
					modifier = cast_hostile_spell
					target = scope:defender
				}
			}
			scope:attacker = {
				has_opinion_modifier = {
					modifier = cast_hostile_spell_on_family_member
					target = scope:defender
				}
			}
		}
	}

	target_de_jure_regions_above = yes

	valid_to_start = {
	}

	should_invalidate = {
	}

	cost = { 
		prestige = { value = minor_prestige_value }
	}

	on_declaration = {
        on_declared_war = yes
	}

	on_victory_desc = {
		desc = imprison_mage_war_victory_desc
	}

	on_victory = {	
		# Gain prestige and imprison the culprit			
		scope:attacker = { add_prestige = medium_prestige_gain }
		scope:defender = { add_prestige = medium_prestige_loss }

		# Legitimacy
		add_legitimacy_attacker_victory_effect = yes
		
		scope:attacker = {
			imprison = {
				target = scope:defender
				type = dungeon
			}
		}
    }
		
	on_white_peace_desc = {
		desc = imprison_mage_war_white_peace_desc
	}

	on_white_peace = {
		scope:attacker = { 
			show_pow_release_message_effect = yes
			stress_impact = {
				ambitious = medium_stress_impact_gain
				arrogant = medium_stress_impact_gain
			}
		}

		scope:defender = {
			stress_impact = {
				arrogant = medium_stress_impact_gain
			}
		}

		add_truce_white_peace_effect = yes
	}

	on_defeat_desc = {
		desc = imprison_mage_war_defeat_desc
	}

	on_defeat = {
		# loose prestige and pay reparations
		scope:attacker = { add_prestige = medium_prestige_loss }
		scope:defender = { add_prestige = medium_prestige_gain }
		
		scope:attacker = {
			pay_short_term_gold_reparations_effect = {
				GOLD_VALUE = 3
			}
		}
		
		#EP2 accolade glory gain for winning against higher ranked enemy
		scope:defender = { accolade_defender_war_end_glory_gain_low_effect = yes }

		add_truce_attacker_defeat_effect = yes

		# Legitimacy
		add_legitimacy_attacker_defeat_effect = yes
	}

	on_invalidated_desc = msg_invalidate_war_title

	on_primary_attacker_death = invalidate
	on_primary_defender_death = invalidate

	transfer_behavior = transfer

	attacker_allies_inherit = no
	defender_allies_inherit = yes

	war_name = "IMPRISON_MAGE_WAR_NAME"
	war_name_base = "IMPRISON_MAGE_WAR_NAME_BASE"
	cb_name = "IMPRISON_MAGE_CB_NAME"

	interface_priority = 80

	use_de_jure_wargoal_only = yes

	attacker_wargoal_percentage = 0.8

	max_attacker_score_from_battles = 100
	max_defender_score_from_battles = 50

	max_ai_diplo_distance_to_title = 500
}

### Punish Raiders War
# Achieves the same as the free hostage war but also regains gold
# punish_raider_war = {
# 	group = other
	
# 	allowed_for_character = {
# 		NOT = { government_has_flag = government_is_tribal }
# 	}

# 	allowed_against_character = {
# 		OR = {
# 			scope:attacker = {
# 				has_opinion_modifier = {
# 					modifier = raided_me_opinion
# 					target = scope:defender
# 				}
# 			}
# 		}
# 	}

# 	target_de_jure_regions_above = yes

# 	valid_to_start = {
# 	}

# 	should_invalidate = {
# 	}

# 	cost = {
# 		piety = {
# 			value = 0
# 			if = {
# 				limit = {
# 					scope:defender.faith = scope:attacker.faith
# 				}
# 				add = {
# 					value = minor_piety_value
# 					desc = CB_SAME_FAITH_COST
# 				}
# 			}
# 			multiply = common_cb_piety_cost_multiplier
# 		}
# 		prestige = {
# 			value = 0
# 			if = {
# 				limit = {
# 					NOT = { scope:defender.faith = scope:attacker.faith }
# 				}
# 				add = {
# 					value = minor_prestige_value
# 					desc = CB_COST_DIFFERENT_FAITH
# 				}
# 			}
# 			multiply = common_cb_prestige_cost_multiplier
# 		}
# 	}

# 	on_declaration = {
#         on_declared_war = yes
# 	}

# 	on_victory_desc = {
# 		desc = punish_raider_war_victory_desc
# 	}

# 	on_victory = {	
# 		# Gain prestige and gold		
# 		scope:attacker = { add_prestige = medium_prestige_gain }
# 		scope:defender = { add_prestige = medium_prestige_loss }
		
# 		scope:defender = {
# 			pay_short_term_gold = {
# 				gold = 3
# 				target = scope:attacker
# 				yearly_income = yes
# 			}
# 		}

# 		#EP2 accolade glory gain from winning against higher ranked enemy
# 		scope:attacker = { accolade_attacker_war_end_glory_gain_low_effect = yes }

# 		scope:defender = {
# 			add_truce_one_way = {
# 				character = scope:attacker
# 				years = 5
# 				war = root.war
# 				result = victory
# 			}
# 		}
#     }
		
# 	on_white_peace_desc = {
# 		desc = punish_raider_war_white_peace_desc
# 	}

# 	on_white_peace = {
# 		scope:attacker = { 
# 			stress_impact = {
# 				ambitious = medium_stress_impact_gain
# 				arrogant = medium_stress_impact_gain
# 			}
# 		}

# 		scope:defender = {
# 			stress_impact = {
# 				arrogant = medium_stress_impact_gain
# 			}
# 		}

# 		add_truce_white_peace_effect = yes
# 	}

# 	on_defeat_desc = {
# 		desc = punish_raider_war_defeat_desc
# 	}

# 	on_defeat = {
# 		# loose prestige and pay reparations
# 		scope:attacker = { add_prestige = medium_prestige_loss }
# 		scope:defender = { add_prestige = medium_prestige_gain }
		
# 		scope:attacker = {
# 			pay_short_term_gold_reparations_effect = {
# 				GOLD_VALUE = 1
# 			}
# 		}
		
# 		#EP2 accolade glory gain for winning against higher ranked enemy
# 		scope:defender = { accolade_defender_war_end_glory_gain_low_effect = yes }

# 		add_truce_attacker_defeat_effect = yes
# 	}

# 	on_invalidated_desc = msg_invalidate_war_title

# 	on_primary_attacker_death = invalidate
# 	on_primary_defender_death = invalidate

# 	transfer_behavior = transfer

# 	attacker_allies_inherit = no
# 	defender_allies_inherit = yes

# 	war_name = "PUNISH_RAIDER_WAR_NAME"
# 	war_name_base = "PUNISH_RAIDER_WAR_NAME_BASE"
# 	cb_name = "PUNISH_RAIDER_CB_NAME"

# 	interface_priority = 80

# 	use_de_jure_wargoal_only = yes

# 	attacker_wargoal_percentage = 0.8

# 	max_attacker_score_from_battles = 100
# 	max_defender_score_from_battles = 50

# 	max_ai_diplo_distance_to_title = 500
# }


### Free Hostages War
# Heavily inspired from hostages_cb in CK2
hostages_war = {
	# COMP 1.9 TODO: CB ICON
	group = other
	
	allowed_for_character =	{
		always = yes
	}

	allowed_against_character = {
		scope:defender = {
			OR = {
				# Either holds a close character from scope:attacker prisoner
				any_prisoner = {
					fc_is_close_kin_trigger = { PRISONER_KIN = scope:attacker }
				}
				# Or has taken a character from scope:attacker's court as concubine
				any_courtier = {
					fc_is_close_kin_trigger = { PRISONER_KIN = scope:attacker }
					has_opinion_modifier = {
						modifier = forced_me_concubine_marriage_opinion
						target = scope:defender
					}
				}
			}
		}
		NOT = {
			scope:attacker = {
				has_opinion_modifier = {
					modifier = raided_me_opinion
					target = scope:defender
				}
			}
		}
	}

	target_de_jure_regions_above = yes

	valid_to_start = {
	}

	should_invalidate = {
	}

	cost = {
		piety = {
			value = 0
			if = {
				limit = {
					scope:defender.faith = scope:attacker.faith
				}
				add = {
					value = minor_piety_value
					desc = CB_SAME_FAITH_COST
				}
			}
			multiply = common_cb_piety_cost_multiplier
		}
		prestige = {
			value = 0
			if = {
				limit = {
					NOT = { scope:defender.faith = scope:attacker.faith }
				}
				add = {
					value = minor_prestige_value
					desc = CB_COST_DIFFERENT_FAITH
				}
			}
			multiply = common_cb_prestige_cost_multiplier
		}
	}

	on_declaration = {
		#on_declared_war = yes
		
		scope:defender = { trigger_event = { id = fc_war_event.0001 days = 5 } }
	}

	on_victory_desc = {
		desc = hostages_war_victory_desc
	}

	on_victory = {
		### Get some prestige, some cash, some renown if same dynasty, even more if same house
		# Get weak hook on everyone you saved (favor), as well as some opinion
		scope:attacker = { show_pow_release_message_effect = yes }
		
		scope:attacker = { add_prestige = medium_prestige_gain }
		scope:defender = { add_prestige = medium_prestige_loss }
		
		scope:defender = {
			every_prisoner = {
				limit = {
					fc_is_close_kin_trigger = { PRISONER_KIN = scope:attacker }
				}
				
				add_to_temporary_list = hostages_war_prisoners_freed
			}
			
			every_courtier = {
				limit = {
					fc_is_close_kin_trigger = { PRISONER_KIN = scope:attacker }
					has_opinion_modifier = {
						modifier = forced_me_concubine_marriage_opinion
						target = scope:defender
					}
				}
				
				add_to_temporary_list = hostages_war_prisoners_freed
			}
		}
		
		every_in_list = {
			list = hostages_war_prisoners_freed
			
			save_scope_as = current_prisoner
			
			fc_enforce_free_captives_effect = {
				JAILOR = scope:defender
				LIBERATOR = scope:attacker
				PRISONER = scope:current_prisoner
			}
		}
		#EP2 accolade glory gain from winning against higher ranked enemy
		scope:attacker = { accolade_attacker_war_end_glory_gain_low_effect = yes }

		scope:defender = {
			add_truce_one_way = {
				character = scope:attacker
				years = 5
				war = root.war
				result = victory
			}
		}
	}

	on_white_peace_desc = {
		desc = hostages_war_white_peace_desc
	}

	on_white_peace = {
		scope:attacker = { 
			show_pow_release_message_effect = yes
			stress_impact = {
				ambitious = medium_stress_impact_gain
				arrogant = medium_stress_impact_gain
			}
		}

		scope:defender = {
			stress_impact = {
				arrogant = medium_stress_impact_gain
			}
		}
	}

	on_defeat_desc = {
		desc = hostages_war_defeat_desc
	}

	on_defeat = {
		# Pay lot of cash, lose some renown
		scope:attacker = { show_pow_release_message_effect = yes }
		
		scope:attacker = { add_prestige = medium_prestige_loss }
		scope:defender = { add_prestige = medium_prestige_gain }
		
		scope:attacker = {
			pay_short_term_gold_reparations_effect = {
				GOLD_VALUE = 3
			}
		}
		
		scope:attacker = {
			if = {
				limit = { exists = this.dynasty }
				this.dynasty = { add_dynasty_prestige = medium_dynasty_prestige_loss }
			}
		}
		#EP2 accolade glory gain for winning against higher ranked enemy
		scope:defender = { accolade_defender_war_end_glory_gain_low_effect = yes }
	}

	on_invalidated_desc = msg_invalidate_war_title

	on_primary_attacker_death = invalidate
	on_primary_defender_death = inherit

	transfer_behavior = transfer

	attacker_allies_inherit = no
	defender_allies_inherit = yes

	war_name = "HOSTAGES_WAR_NAME"

	interface_priority = 80

	use_de_jure_wargoal_only = yes

	attacker_wargoal_percentage = 0.8

	max_attacker_score_from_battles = 100
	max_defender_score_from_battles = 50

	max_ai_diplo_distance_to_title = 500
}

